name: Checks

on:
  workflow_call:

jobs:
  gauntlet:
    name: Run the Gauntlet ðŸ¤º
    runs-on: ubuntu-latest
    timeout-minutes: 5
    steps:
      - uses: actions/checkout@v3
      - uses: ./.github/workflows/actions/prepare

      - uses: actions/cache@v3
        id: lint-cache
        name: Restore lint caches
        with:
          path: |
            .quilt/prettier/cache
            .quilt/eslint/cache/
            .quilt/stylelint/cache

          key: ${{ runner.os }}-lint-v1-${{ github.sha }}
          restore-keys: |
            ${{ runner.os }}-lint-v1-

      - uses: actions/cache@v3
        id: typescript-cache
        name: Restore TypeScript cache
        with:
          path: |
            **/build/typescript/
            **/*.tsbuildinfo
          key: ${{ runner.os }}-typescript-v1-${{ github.sha }}
          restore-keys: |
            ${{ runner.os }}-typescript-v1-

      - uses: actions/cache@v3
        id: jest-cache
        name: Restore Jest caches
        with:
          path: .quilt/jest/cache/
          key: ${{ runner.os }}-jest-v1-${{ github.sha }}
          restore-keys: |
            ${{ runner.os }}-jest-v1-

      - name: Run the Gauntlet
        run: pnpm run gauntlet
